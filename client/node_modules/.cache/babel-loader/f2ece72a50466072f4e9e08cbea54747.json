{"ast":null,"code":"import { Util } from './Util.js';\nimport { Konva } from './Global.js';\n\nfunction simplifyArray(arr) {\n  var retArr = [],\n      len = arr.length,\n      util = Util,\n      n,\n      val;\n\n  for (n = 0; n < len; n++) {\n    val = arr[n];\n\n    if (util._isNumber(val)) {\n      val = Math.round(val * 1000) / 1000;\n    } else if (!util._isString(val)) {\n      val = val + '';\n    }\n\n    retArr.push(val);\n  }\n\n  return retArr;\n}\n\nvar COMMA = ',',\n    OPEN_PAREN = '(',\n    CLOSE_PAREN = ')',\n    OPEN_PAREN_BRACKET = '([',\n    CLOSE_BRACKET_PAREN = '])',\n    SEMICOLON = ';',\n    DOUBLE_PAREN = '()',\n    EQUALS = '=',\n    CONTEXT_METHODS = ['arc', 'arcTo', 'beginPath', 'bezierCurveTo', 'clearRect', 'clip', 'closePath', 'createLinearGradient', 'createPattern', 'createRadialGradient', 'drawImage', 'ellipse', 'fill', 'fillText', 'getImageData', 'createImageData', 'lineTo', 'moveTo', 'putImageData', 'quadraticCurveTo', 'rect', 'restore', 'rotate', 'save', 'scale', 'setLineDash', 'setTransform', 'stroke', 'strokeText', 'transform', 'translate'];\nvar CONTEXT_PROPERTIES = ['fillStyle', 'strokeStyle', 'shadowColor', 'shadowBlur', 'shadowOffsetX', 'shadowOffsetY', 'lineCap', 'lineDashOffset', 'lineJoin', 'lineWidth', 'miterLimit', 'font', 'textAlign', 'textBaseline', 'globalAlpha', 'globalCompositeOperation', 'imageSmoothingEnabled'];\nconst traceArrMax = 100;\nexport class Context {\n  constructor(canvas) {\n    this.canvas = canvas;\n    this._context = canvas._canvas.getContext('2d');\n\n    if (Konva.enableTrace) {\n      this.traceArr = [];\n\n      this._enableTrace();\n    }\n  }\n\n  fillShape(shape) {\n    if (shape.fillEnabled()) {\n      this._fill(shape);\n    }\n  }\n\n  _fill(shape) {}\n\n  strokeShape(shape) {\n    if (shape.hasStroke()) {\n      this._stroke(shape);\n    }\n  }\n\n  _stroke(shape) {}\n\n  fillStrokeShape(shape) {\n    if (shape.attrs.fillAfterStrokeEnabled) {\n      this.strokeShape(shape);\n      this.fillShape(shape);\n    } else {\n      this.fillShape(shape);\n      this.strokeShape(shape);\n    }\n  }\n\n  getTrace(relaxed, rounded) {\n    var traceArr = this.traceArr,\n        len = traceArr.length,\n        str = '',\n        n,\n        trace,\n        method,\n        args;\n\n    for (n = 0; n < len; n++) {\n      trace = traceArr[n];\n      method = trace.method;\n\n      if (method) {\n        args = trace.args;\n        str += method;\n\n        if (relaxed) {\n          str += DOUBLE_PAREN;\n        } else {\n          if (Util._isArray(args[0])) {\n            str += OPEN_PAREN_BRACKET + args.join(COMMA) + CLOSE_BRACKET_PAREN;\n          } else {\n            if (rounded) {\n              args = args.map(a => typeof a === 'number' ? Math.floor(a) : a);\n            }\n\n            str += OPEN_PAREN + args.join(COMMA) + CLOSE_PAREN;\n          }\n        }\n      } else {\n        str += trace.property;\n\n        if (!relaxed) {\n          str += EQUALS + trace.val;\n        }\n      }\n\n      str += SEMICOLON;\n    }\n\n    return str;\n  }\n\n  clearTrace() {\n    this.traceArr = [];\n  }\n\n  _trace(str) {\n    var traceArr = this.traceArr,\n        len;\n    traceArr.push(str);\n    len = traceArr.length;\n\n    if (len >= traceArrMax) {\n      traceArr.shift();\n    }\n  }\n\n  reset() {\n    var pixelRatio = this.getCanvas().getPixelRatio();\n    this.setTransform(1 * pixelRatio, 0, 0, 1 * pixelRatio, 0, 0);\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  clear(bounds) {\n    var canvas = this.getCanvas();\n\n    if (bounds) {\n      this.clearRect(bounds.x || 0, bounds.y || 0, bounds.width || 0, bounds.height || 0);\n    } else {\n      this.clearRect(0, 0, canvas.getWidth() / canvas.pixelRatio, canvas.getHeight() / canvas.pixelRatio);\n    }\n  }\n\n  _applyLineCap(shape) {\n    var lineCap = shape.getLineCap();\n\n    if (lineCap) {\n      this.setAttr('lineCap', lineCap);\n    }\n  }\n\n  _applyOpacity(shape) {\n    var absOpacity = shape.getAbsoluteOpacity();\n\n    if (absOpacity !== 1) {\n      this.setAttr('globalAlpha', absOpacity);\n    }\n  }\n\n  _applyLineJoin(shape) {\n    var lineJoin = shape.attrs.lineJoin;\n\n    if (lineJoin) {\n      this.setAttr('lineJoin', lineJoin);\n    }\n  }\n\n  setAttr(attr, val) {\n    this._context[attr] = val;\n  }\n\n  arc(a0, a1, a2, a3, a4, a5) {\n    this._context.arc(a0, a1, a2, a3, a4, a5);\n  }\n\n  arcTo(a0, a1, a2, a3, a4) {\n    this._context.arcTo(a0, a1, a2, a3, a4);\n  }\n\n  beginPath() {\n    this._context.beginPath();\n  }\n\n  bezierCurveTo(a0, a1, a2, a3, a4, a5) {\n    this._context.bezierCurveTo(a0, a1, a2, a3, a4, a5);\n  }\n\n  clearRect(a0, a1, a2, a3) {\n    this._context.clearRect(a0, a1, a2, a3);\n  }\n\n  clip() {\n    this._context.clip();\n  }\n\n  closePath() {\n    this._context.closePath();\n  }\n\n  createImageData(a0, a1) {\n    var a = arguments;\n\n    if (a.length === 2) {\n      return this._context.createImageData(a0, a1);\n    } else if (a.length === 1) {\n      return this._context.createImageData(a0);\n    }\n  }\n\n  createLinearGradient(a0, a1, a2, a3) {\n    return this._context.createLinearGradient(a0, a1, a2, a3);\n  }\n\n  createPattern(a0, a1) {\n    return this._context.createPattern(a0, a1);\n  }\n\n  createRadialGradient(a0, a1, a2, a3, a4, a5) {\n    return this._context.createRadialGradient(a0, a1, a2, a3, a4, a5);\n  }\n\n  drawImage(a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n    var a = arguments,\n        _context = this._context;\n\n    if (a.length === 3) {\n      _context.drawImage(a0, a1, a2);\n    } else if (a.length === 5) {\n      _context.drawImage(a0, a1, a2, a3, a4);\n    } else if (a.length === 9) {\n      _context.drawImage(a0, a1, a2, a3, a4, a5, a6, a7, a8);\n    }\n  }\n\n  ellipse(a0, a1, a2, a3, a4, a5, a6, a7) {\n    this._context.ellipse(a0, a1, a2, a3, a4, a5, a6, a7);\n  }\n\n  isPointInPath(x, y) {\n    return this._context.isPointInPath(x, y);\n  }\n\n  fill(path2d) {\n    if (path2d) {\n      this._context.fill(path2d);\n    } else {\n      this._context.fill();\n    }\n  }\n\n  fillRect(x, y, width, height) {\n    this._context.fillRect(x, y, width, height);\n  }\n\n  strokeRect(x, y, width, height) {\n    this._context.strokeRect(x, y, width, height);\n  }\n\n  fillText(text, x, y, maxWidth) {\n    if (maxWidth) {\n      this._context.fillText(text, x, y, maxWidth);\n    } else {\n      this._context.fillText(text, x, y);\n    }\n  }\n\n  measureText(text) {\n    return this._context.measureText(text);\n  }\n\n  getImageData(a0, a1, a2, a3) {\n    return this._context.getImageData(a0, a1, a2, a3);\n  }\n\n  lineTo(a0, a1) {\n    this._context.lineTo(a0, a1);\n  }\n\n  moveTo(a0, a1) {\n    this._context.moveTo(a0, a1);\n  }\n\n  rect(a0, a1, a2, a3) {\n    this._context.rect(a0, a1, a2, a3);\n  }\n\n  putImageData(a0, a1, a2) {\n    this._context.putImageData(a0, a1, a2);\n  }\n\n  quadraticCurveTo(a0, a1, a2, a3) {\n    this._context.quadraticCurveTo(a0, a1, a2, a3);\n  }\n\n  restore() {\n    this._context.restore();\n  }\n\n  rotate(a0) {\n    this._context.rotate(a0);\n  }\n\n  save() {\n    this._context.save();\n  }\n\n  scale(a0, a1) {\n    this._context.scale(a0, a1);\n  }\n\n  setLineDash(a0) {\n    if (this._context.setLineDash) {\n      this._context.setLineDash(a0);\n    } else if ('mozDash' in this._context) {\n      this._context['mozDash'] = a0;\n    } else if ('webkitLineDash' in this._context) {\n      this._context['webkitLineDash'] = a0;\n    }\n  }\n\n  getLineDash() {\n    return this._context.getLineDash();\n  }\n\n  setTransform(a0, a1, a2, a3, a4, a5) {\n    this._context.setTransform(a0, a1, a2, a3, a4, a5);\n  }\n\n  stroke(path2d) {\n    if (path2d) {\n      this._context.stroke(path2d);\n    } else {\n      this._context.stroke();\n    }\n  }\n\n  strokeText(a0, a1, a2, a3) {\n    this._context.strokeText(a0, a1, a2, a3);\n  }\n\n  transform(a0, a1, a2, a3, a4, a5) {\n    this._context.transform(a0, a1, a2, a3, a4, a5);\n  }\n\n  translate(a0, a1) {\n    this._context.translate(a0, a1);\n  }\n\n  _enableTrace() {\n    var that = this,\n        len = CONTEXT_METHODS.length,\n        origSetter = this.setAttr,\n        n,\n        args;\n\n    var func = function (methodName) {\n      var origMethod = that[methodName],\n          ret;\n\n      that[methodName] = function () {\n        args = simplifyArray(Array.prototype.slice.call(arguments, 0));\n        ret = origMethod.apply(that, arguments);\n\n        that._trace({\n          method: methodName,\n          args: args\n        });\n\n        return ret;\n      };\n    };\n\n    for (n = 0; n < len; n++) {\n      func(CONTEXT_METHODS[n]);\n    }\n\n    that.setAttr = function () {\n      origSetter.apply(that, arguments);\n      var prop = arguments[0];\n      var val = arguments[1];\n\n      if (prop === 'shadowOffsetX' || prop === 'shadowOffsetY' || prop === 'shadowBlur') {\n        val = val / this.canvas.getPixelRatio();\n      }\n\n      that._trace({\n        property: prop,\n        val: val\n      });\n    };\n  }\n\n  _applyGlobalCompositeOperation(node) {\n    const op = node.attrs.globalCompositeOperation;\n    var def = !op || op === 'source-over';\n\n    if (!def) {\n      this.setAttr('globalCompositeOperation', op);\n    }\n  }\n\n}\nCONTEXT_PROPERTIES.forEach(function (prop) {\n  Object.defineProperty(Context.prototype, prop, {\n    get() {\n      return this._context[prop];\n    },\n\n    set(val) {\n      this._context[prop] = val;\n    }\n\n  });\n});\nexport class SceneContext extends Context {\n  _fillColor(shape) {\n    var fill = shape.fill();\n    this.setAttr('fillStyle', fill);\n\n    shape._fillFunc(this);\n  }\n\n  _fillPattern(shape) {\n    this.setAttr('fillStyle', shape._getFillPattern());\n\n    shape._fillFunc(this);\n  }\n\n  _fillLinearGradient(shape) {\n    var grd = shape._getLinearGradient();\n\n    if (grd) {\n      this.setAttr('fillStyle', grd);\n\n      shape._fillFunc(this);\n    }\n  }\n\n  _fillRadialGradient(shape) {\n    var grd = shape._getRadialGradient();\n\n    if (grd) {\n      this.setAttr('fillStyle', grd);\n\n      shape._fillFunc(this);\n    }\n  }\n\n  _fill(shape) {\n    var hasColor = shape.fill(),\n        fillPriority = shape.getFillPriority();\n\n    if (hasColor && fillPriority === 'color') {\n      this._fillColor(shape);\n\n      return;\n    }\n\n    var hasPattern = shape.getFillPatternImage();\n\n    if (hasPattern && fillPriority === 'pattern') {\n      this._fillPattern(shape);\n\n      return;\n    }\n\n    var hasLinearGradient = shape.getFillLinearGradientColorStops();\n\n    if (hasLinearGradient && fillPriority === 'linear-gradient') {\n      this._fillLinearGradient(shape);\n\n      return;\n    }\n\n    var hasRadialGradient = shape.getFillRadialGradientColorStops();\n\n    if (hasRadialGradient && fillPriority === 'radial-gradient') {\n      this._fillRadialGradient(shape);\n\n      return;\n    }\n\n    if (hasColor) {\n      this._fillColor(shape);\n    } else if (hasPattern) {\n      this._fillPattern(shape);\n    } else if (hasLinearGradient) {\n      this._fillLinearGradient(shape);\n    } else if (hasRadialGradient) {\n      this._fillRadialGradient(shape);\n    }\n  }\n\n  _strokeLinearGradient(shape) {\n    var start = shape.getStrokeLinearGradientStartPoint(),\n        end = shape.getStrokeLinearGradientEndPoint(),\n        colorStops = shape.getStrokeLinearGradientColorStops(),\n        grd = this.createLinearGradient(start.x, start.y, end.x, end.y);\n\n    if (colorStops) {\n      for (var n = 0; n < colorStops.length; n += 2) {\n        grd.addColorStop(colorStops[n], colorStops[n + 1]);\n      }\n\n      this.setAttr('strokeStyle', grd);\n    }\n  }\n\n  _stroke(shape) {\n    var dash = shape.dash(),\n        strokeScaleEnabled = shape.getStrokeScaleEnabled();\n\n    if (shape.hasStroke()) {\n      if (!strokeScaleEnabled) {\n        this.save();\n        var pixelRatio = this.getCanvas().getPixelRatio();\n        this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n      }\n\n      this._applyLineCap(shape);\n\n      if (dash && shape.dashEnabled()) {\n        this.setLineDash(dash);\n        this.setAttr('lineDashOffset', shape.dashOffset());\n      }\n\n      this.setAttr('lineWidth', shape.strokeWidth());\n\n      if (!shape.getShadowForStrokeEnabled()) {\n        this.setAttr('shadowColor', 'rgba(0,0,0,0)');\n      }\n\n      var hasLinearGradient = shape.getStrokeLinearGradientColorStops();\n\n      if (hasLinearGradient) {\n        this._strokeLinearGradient(shape);\n      } else {\n        this.setAttr('strokeStyle', shape.stroke());\n      }\n\n      shape._strokeFunc(this);\n\n      if (!strokeScaleEnabled) {\n        this.restore();\n      }\n    }\n  }\n\n  _applyShadow(shape) {\n    var _a, _b, _c;\n\n    var color = (_a = shape.getShadowRGBA()) !== null && _a !== void 0 ? _a : 'black',\n        blur = (_b = shape.getShadowBlur()) !== null && _b !== void 0 ? _b : 5,\n        offset = (_c = shape.getShadowOffset()) !== null && _c !== void 0 ? _c : {\n      x: 0,\n      y: 0\n    },\n        scale = shape.getAbsoluteScale(),\n        ratio = this.canvas.getPixelRatio(),\n        scaleX = scale.x * ratio,\n        scaleY = scale.y * ratio;\n    this.setAttr('shadowColor', color);\n    this.setAttr('shadowBlur', blur * Math.min(Math.abs(scaleX), Math.abs(scaleY)));\n    this.setAttr('shadowOffsetX', offset.x * scaleX);\n    this.setAttr('shadowOffsetY', offset.y * scaleY);\n  }\n\n}\nexport class HitContext extends Context {\n  _fill(shape) {\n    this.save();\n    this.setAttr('fillStyle', shape.colorKey);\n\n    shape._fillFuncHit(this);\n\n    this.restore();\n  }\n\n  strokeShape(shape) {\n    if (shape.hasHitStroke()) {\n      this._stroke(shape);\n    }\n  }\n\n  _stroke(shape) {\n    if (shape.hasHitStroke()) {\n      var strokeScaleEnabled = shape.getStrokeScaleEnabled();\n\n      if (!strokeScaleEnabled) {\n        this.save();\n        var pixelRatio = this.getCanvas().getPixelRatio();\n        this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n      }\n\n      this._applyLineCap(shape);\n\n      var hitStrokeWidth = shape.hitStrokeWidth();\n      var strokeWidth = hitStrokeWidth === 'auto' ? shape.strokeWidth() : hitStrokeWidth;\n      this.setAttr('lineWidth', strokeWidth);\n      this.setAttr('strokeStyle', shape.colorKey);\n\n      shape._strokeFuncHit(this);\n\n      if (!strokeScaleEnabled) {\n        this.restore();\n      }\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/stevec/Codeclan_Work/Group_Project/SnakesAndLadders/client/node_modules/konva/lib/Context.js"],"names":["Util","Konva","simplifyArray","arr","retArr","len","length","util","n","val","_isNumber","Math","round","_isString","push","COMMA","OPEN_PAREN","CLOSE_PAREN","OPEN_PAREN_BRACKET","CLOSE_BRACKET_PAREN","SEMICOLON","DOUBLE_PAREN","EQUALS","CONTEXT_METHODS","CONTEXT_PROPERTIES","traceArrMax","Context","constructor","canvas","_context","_canvas","getContext","enableTrace","traceArr","_enableTrace","fillShape","shape","fillEnabled","_fill","strokeShape","hasStroke","_stroke","fillStrokeShape","attrs","fillAfterStrokeEnabled","getTrace","relaxed","rounded","str","trace","method","args","_isArray","join","map","a","floor","property","clearTrace","_trace","shift","reset","pixelRatio","getCanvas","getPixelRatio","setTransform","clear","bounds","clearRect","x","y","width","height","getWidth","getHeight","_applyLineCap","lineCap","getLineCap","setAttr","_applyOpacity","absOpacity","getAbsoluteOpacity","_applyLineJoin","lineJoin","attr","arc","a0","a1","a2","a3","a4","a5","arcTo","beginPath","bezierCurveTo","clip","closePath","createImageData","arguments","createLinearGradient","createPattern","createRadialGradient","drawImage","a6","a7","a8","ellipse","isPointInPath","fill","path2d","fillRect","strokeRect","fillText","text","maxWidth","measureText","getImageData","lineTo","moveTo","rect","putImageData","quadraticCurveTo","restore","rotate","save","scale","setLineDash","getLineDash","stroke","strokeText","transform","translate","that","origSetter","func","methodName","origMethod","ret","Array","prototype","slice","call","apply","prop","_applyGlobalCompositeOperation","node","op","globalCompositeOperation","def","forEach","Object","defineProperty","get","set","SceneContext","_fillColor","_fillFunc","_fillPattern","_getFillPattern","_fillLinearGradient","grd","_getLinearGradient","_fillRadialGradient","_getRadialGradient","hasColor","fillPriority","getFillPriority","hasPattern","getFillPatternImage","hasLinearGradient","getFillLinearGradientColorStops","hasRadialGradient","getFillRadialGradientColorStops","_strokeLinearGradient","start","getStrokeLinearGradientStartPoint","end","getStrokeLinearGradientEndPoint","colorStops","getStrokeLinearGradientColorStops","addColorStop","dash","strokeScaleEnabled","getStrokeScaleEnabled","dashEnabled","dashOffset","strokeWidth","getShadowForStrokeEnabled","_strokeFunc","_applyShadow","_a","_b","_c","color","getShadowRGBA","blur","getShadowBlur","offset","getShadowOffset","getAbsoluteScale","ratio","scaleX","scaleY","min","abs","HitContext","colorKey","_fillFuncHit","hasHitStroke","hitStrokeWidth","_strokeFuncHit"],"mappings":"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","sourcesContent":["import { Util } from './Util.js';\nimport { Konva } from './Global.js';\nfunction simplifyArray(arr) {\n    var retArr = [], len = arr.length, util = Util, n, val;\n    for (n = 0; n < len; n++) {\n        val = arr[n];\n        if (util._isNumber(val)) {\n            val = Math.round(val * 1000) / 1000;\n        }\n        else if (!util._isString(val)) {\n            val = val + '';\n        }\n        retArr.push(val);\n    }\n    return retArr;\n}\nvar COMMA = ',', OPEN_PAREN = '(', CLOSE_PAREN = ')', OPEN_PAREN_BRACKET = '([', CLOSE_BRACKET_PAREN = '])', SEMICOLON = ';', DOUBLE_PAREN = '()', EQUALS = '=', CONTEXT_METHODS = [\n    'arc',\n    'arcTo',\n    'beginPath',\n    'bezierCurveTo',\n    'clearRect',\n    'clip',\n    'closePath',\n    'createLinearGradient',\n    'createPattern',\n    'createRadialGradient',\n    'drawImage',\n    'ellipse',\n    'fill',\n    'fillText',\n    'getImageData',\n    'createImageData',\n    'lineTo',\n    'moveTo',\n    'putImageData',\n    'quadraticCurveTo',\n    'rect',\n    'restore',\n    'rotate',\n    'save',\n    'scale',\n    'setLineDash',\n    'setTransform',\n    'stroke',\n    'strokeText',\n    'transform',\n    'translate',\n];\nvar CONTEXT_PROPERTIES = [\n    'fillStyle',\n    'strokeStyle',\n    'shadowColor',\n    'shadowBlur',\n    'shadowOffsetX',\n    'shadowOffsetY',\n    'lineCap',\n    'lineDashOffset',\n    'lineJoin',\n    'lineWidth',\n    'miterLimit',\n    'font',\n    'textAlign',\n    'textBaseline',\n    'globalAlpha',\n    'globalCompositeOperation',\n    'imageSmoothingEnabled',\n];\nconst traceArrMax = 100;\nexport class Context {\n    constructor(canvas) {\n        this.canvas = canvas;\n        this._context = canvas._canvas.getContext('2d');\n        if (Konva.enableTrace) {\n            this.traceArr = [];\n            this._enableTrace();\n        }\n    }\n    fillShape(shape) {\n        if (shape.fillEnabled()) {\n            this._fill(shape);\n        }\n    }\n    _fill(shape) {\n    }\n    strokeShape(shape) {\n        if (shape.hasStroke()) {\n            this._stroke(shape);\n        }\n    }\n    _stroke(shape) {\n    }\n    fillStrokeShape(shape) {\n        if (shape.attrs.fillAfterStrokeEnabled) {\n            this.strokeShape(shape);\n            this.fillShape(shape);\n        }\n        else {\n            this.fillShape(shape);\n            this.strokeShape(shape);\n        }\n    }\n    getTrace(relaxed, rounded) {\n        var traceArr = this.traceArr, len = traceArr.length, str = '', n, trace, method, args;\n        for (n = 0; n < len; n++) {\n            trace = traceArr[n];\n            method = trace.method;\n            if (method) {\n                args = trace.args;\n                str += method;\n                if (relaxed) {\n                    str += DOUBLE_PAREN;\n                }\n                else {\n                    if (Util._isArray(args[0])) {\n                        str += OPEN_PAREN_BRACKET + args.join(COMMA) + CLOSE_BRACKET_PAREN;\n                    }\n                    else {\n                        if (rounded) {\n                            args = args.map((a) => typeof a === 'number' ? Math.floor(a) : a);\n                        }\n                        str += OPEN_PAREN + args.join(COMMA) + CLOSE_PAREN;\n                    }\n                }\n            }\n            else {\n                str += trace.property;\n                if (!relaxed) {\n                    str += EQUALS + trace.val;\n                }\n            }\n            str += SEMICOLON;\n        }\n        return str;\n    }\n    clearTrace() {\n        this.traceArr = [];\n    }\n    _trace(str) {\n        var traceArr = this.traceArr, len;\n        traceArr.push(str);\n        len = traceArr.length;\n        if (len >= traceArrMax) {\n            traceArr.shift();\n        }\n    }\n    reset() {\n        var pixelRatio = this.getCanvas().getPixelRatio();\n        this.setTransform(1 * pixelRatio, 0, 0, 1 * pixelRatio, 0, 0);\n    }\n    getCanvas() {\n        return this.canvas;\n    }\n    clear(bounds) {\n        var canvas = this.getCanvas();\n        if (bounds) {\n            this.clearRect(bounds.x || 0, bounds.y || 0, bounds.width || 0, bounds.height || 0);\n        }\n        else {\n            this.clearRect(0, 0, canvas.getWidth() / canvas.pixelRatio, canvas.getHeight() / canvas.pixelRatio);\n        }\n    }\n    _applyLineCap(shape) {\n        var lineCap = shape.getLineCap();\n        if (lineCap) {\n            this.setAttr('lineCap', lineCap);\n        }\n    }\n    _applyOpacity(shape) {\n        var absOpacity = shape.getAbsoluteOpacity();\n        if (absOpacity !== 1) {\n            this.setAttr('globalAlpha', absOpacity);\n        }\n    }\n    _applyLineJoin(shape) {\n        var lineJoin = shape.attrs.lineJoin;\n        if (lineJoin) {\n            this.setAttr('lineJoin', lineJoin);\n        }\n    }\n    setAttr(attr, val) {\n        this._context[attr] = val;\n    }\n    arc(a0, a1, a2, a3, a4, a5) {\n        this._context.arc(a0, a1, a2, a3, a4, a5);\n    }\n    arcTo(a0, a1, a2, a3, a4) {\n        this._context.arcTo(a0, a1, a2, a3, a4);\n    }\n    beginPath() {\n        this._context.beginPath();\n    }\n    bezierCurveTo(a0, a1, a2, a3, a4, a5) {\n        this._context.bezierCurveTo(a0, a1, a2, a3, a4, a5);\n    }\n    clearRect(a0, a1, a2, a3) {\n        this._context.clearRect(a0, a1, a2, a3);\n    }\n    clip() {\n        this._context.clip();\n    }\n    closePath() {\n        this._context.closePath();\n    }\n    createImageData(a0, a1) {\n        var a = arguments;\n        if (a.length === 2) {\n            return this._context.createImageData(a0, a1);\n        }\n        else if (a.length === 1) {\n            return this._context.createImageData(a0);\n        }\n    }\n    createLinearGradient(a0, a1, a2, a3) {\n        return this._context.createLinearGradient(a0, a1, a2, a3);\n    }\n    createPattern(a0, a1) {\n        return this._context.createPattern(a0, a1);\n    }\n    createRadialGradient(a0, a1, a2, a3, a4, a5) {\n        return this._context.createRadialGradient(a0, a1, a2, a3, a4, a5);\n    }\n    drawImage(a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n        var a = arguments, _context = this._context;\n        if (a.length === 3) {\n            _context.drawImage(a0, a1, a2);\n        }\n        else if (a.length === 5) {\n            _context.drawImage(a0, a1, a2, a3, a4);\n        }\n        else if (a.length === 9) {\n            _context.drawImage(a0, a1, a2, a3, a4, a5, a6, a7, a8);\n        }\n    }\n    ellipse(a0, a1, a2, a3, a4, a5, a6, a7) {\n        this._context.ellipse(a0, a1, a2, a3, a4, a5, a6, a7);\n    }\n    isPointInPath(x, y) {\n        return this._context.isPointInPath(x, y);\n    }\n    fill(path2d) {\n        if (path2d) {\n            this._context.fill(path2d);\n        }\n        else {\n            this._context.fill();\n        }\n    }\n    fillRect(x, y, width, height) {\n        this._context.fillRect(x, y, width, height);\n    }\n    strokeRect(x, y, width, height) {\n        this._context.strokeRect(x, y, width, height);\n    }\n    fillText(text, x, y, maxWidth) {\n        if (maxWidth) {\n            this._context.fillText(text, x, y, maxWidth);\n        }\n        else {\n            this._context.fillText(text, x, y);\n        }\n    }\n    measureText(text) {\n        return this._context.measureText(text);\n    }\n    getImageData(a0, a1, a2, a3) {\n        return this._context.getImageData(a0, a1, a2, a3);\n    }\n    lineTo(a0, a1) {\n        this._context.lineTo(a0, a1);\n    }\n    moveTo(a0, a1) {\n        this._context.moveTo(a0, a1);\n    }\n    rect(a0, a1, a2, a3) {\n        this._context.rect(a0, a1, a2, a3);\n    }\n    putImageData(a0, a1, a2) {\n        this._context.putImageData(a0, a1, a2);\n    }\n    quadraticCurveTo(a0, a1, a2, a3) {\n        this._context.quadraticCurveTo(a0, a1, a2, a3);\n    }\n    restore() {\n        this._context.restore();\n    }\n    rotate(a0) {\n        this._context.rotate(a0);\n    }\n    save() {\n        this._context.save();\n    }\n    scale(a0, a1) {\n        this._context.scale(a0, a1);\n    }\n    setLineDash(a0) {\n        if (this._context.setLineDash) {\n            this._context.setLineDash(a0);\n        }\n        else if ('mozDash' in this._context) {\n            this._context['mozDash'] = a0;\n        }\n        else if ('webkitLineDash' in this._context) {\n            this._context['webkitLineDash'] = a0;\n        }\n    }\n    getLineDash() {\n        return this._context.getLineDash();\n    }\n    setTransform(a0, a1, a2, a3, a4, a5) {\n        this._context.setTransform(a0, a1, a2, a3, a4, a5);\n    }\n    stroke(path2d) {\n        if (path2d) {\n            this._context.stroke(path2d);\n        }\n        else {\n            this._context.stroke();\n        }\n    }\n    strokeText(a0, a1, a2, a3) {\n        this._context.strokeText(a0, a1, a2, a3);\n    }\n    transform(a0, a1, a2, a3, a4, a5) {\n        this._context.transform(a0, a1, a2, a3, a4, a5);\n    }\n    translate(a0, a1) {\n        this._context.translate(a0, a1);\n    }\n    _enableTrace() {\n        var that = this, len = CONTEXT_METHODS.length, origSetter = this.setAttr, n, args;\n        var func = function (methodName) {\n            var origMethod = that[methodName], ret;\n            that[methodName] = function () {\n                args = simplifyArray(Array.prototype.slice.call(arguments, 0));\n                ret = origMethod.apply(that, arguments);\n                that._trace({\n                    method: methodName,\n                    args: args,\n                });\n                return ret;\n            };\n        };\n        for (n = 0; n < len; n++) {\n            func(CONTEXT_METHODS[n]);\n        }\n        that.setAttr = function () {\n            origSetter.apply(that, arguments);\n            var prop = arguments[0];\n            var val = arguments[1];\n            if (prop === 'shadowOffsetX' ||\n                prop === 'shadowOffsetY' ||\n                prop === 'shadowBlur') {\n                val = val / this.canvas.getPixelRatio();\n            }\n            that._trace({\n                property: prop,\n                val: val,\n            });\n        };\n    }\n    _applyGlobalCompositeOperation(node) {\n        const op = node.attrs.globalCompositeOperation;\n        var def = !op || op === 'source-over';\n        if (!def) {\n            this.setAttr('globalCompositeOperation', op);\n        }\n    }\n}\nCONTEXT_PROPERTIES.forEach(function (prop) {\n    Object.defineProperty(Context.prototype, prop, {\n        get() {\n            return this._context[prop];\n        },\n        set(val) {\n            this._context[prop] = val;\n        },\n    });\n});\nexport class SceneContext extends Context {\n    _fillColor(shape) {\n        var fill = shape.fill();\n        this.setAttr('fillStyle', fill);\n        shape._fillFunc(this);\n    }\n    _fillPattern(shape) {\n        this.setAttr('fillStyle', shape._getFillPattern());\n        shape._fillFunc(this);\n    }\n    _fillLinearGradient(shape) {\n        var grd = shape._getLinearGradient();\n        if (grd) {\n            this.setAttr('fillStyle', grd);\n            shape._fillFunc(this);\n        }\n    }\n    _fillRadialGradient(shape) {\n        var grd = shape._getRadialGradient();\n        if (grd) {\n            this.setAttr('fillStyle', grd);\n            shape._fillFunc(this);\n        }\n    }\n    _fill(shape) {\n        var hasColor = shape.fill(), fillPriority = shape.getFillPriority();\n        if (hasColor && fillPriority === 'color') {\n            this._fillColor(shape);\n            return;\n        }\n        var hasPattern = shape.getFillPatternImage();\n        if (hasPattern && fillPriority === 'pattern') {\n            this._fillPattern(shape);\n            return;\n        }\n        var hasLinearGradient = shape.getFillLinearGradientColorStops();\n        if (hasLinearGradient && fillPriority === 'linear-gradient') {\n            this._fillLinearGradient(shape);\n            return;\n        }\n        var hasRadialGradient = shape.getFillRadialGradientColorStops();\n        if (hasRadialGradient && fillPriority === 'radial-gradient') {\n            this._fillRadialGradient(shape);\n            return;\n        }\n        if (hasColor) {\n            this._fillColor(shape);\n        }\n        else if (hasPattern) {\n            this._fillPattern(shape);\n        }\n        else if (hasLinearGradient) {\n            this._fillLinearGradient(shape);\n        }\n        else if (hasRadialGradient) {\n            this._fillRadialGradient(shape);\n        }\n    }\n    _strokeLinearGradient(shape) {\n        var start = shape.getStrokeLinearGradientStartPoint(), end = shape.getStrokeLinearGradientEndPoint(), colorStops = shape.getStrokeLinearGradientColorStops(), grd = this.createLinearGradient(start.x, start.y, end.x, end.y);\n        if (colorStops) {\n            for (var n = 0; n < colorStops.length; n += 2) {\n                grd.addColorStop(colorStops[n], colorStops[n + 1]);\n            }\n            this.setAttr('strokeStyle', grd);\n        }\n    }\n    _stroke(shape) {\n        var dash = shape.dash(), strokeScaleEnabled = shape.getStrokeScaleEnabled();\n        if (shape.hasStroke()) {\n            if (!strokeScaleEnabled) {\n                this.save();\n                var pixelRatio = this.getCanvas().getPixelRatio();\n                this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n            }\n            this._applyLineCap(shape);\n            if (dash && shape.dashEnabled()) {\n                this.setLineDash(dash);\n                this.setAttr('lineDashOffset', shape.dashOffset());\n            }\n            this.setAttr('lineWidth', shape.strokeWidth());\n            if (!shape.getShadowForStrokeEnabled()) {\n                this.setAttr('shadowColor', 'rgba(0,0,0,0)');\n            }\n            var hasLinearGradient = shape.getStrokeLinearGradientColorStops();\n            if (hasLinearGradient) {\n                this._strokeLinearGradient(shape);\n            }\n            else {\n                this.setAttr('strokeStyle', shape.stroke());\n            }\n            shape._strokeFunc(this);\n            if (!strokeScaleEnabled) {\n                this.restore();\n            }\n        }\n    }\n    _applyShadow(shape) {\n        var _a, _b, _c;\n        var color = (_a = shape.getShadowRGBA()) !== null && _a !== void 0 ? _a : 'black', blur = (_b = shape.getShadowBlur()) !== null && _b !== void 0 ? _b : 5, offset = (_c = shape.getShadowOffset()) !== null && _c !== void 0 ? _c : {\n            x: 0,\n            y: 0,\n        }, scale = shape.getAbsoluteScale(), ratio = this.canvas.getPixelRatio(), scaleX = scale.x * ratio, scaleY = scale.y * ratio;\n        this.setAttr('shadowColor', color);\n        this.setAttr('shadowBlur', blur * Math.min(Math.abs(scaleX), Math.abs(scaleY)));\n        this.setAttr('shadowOffsetX', offset.x * scaleX);\n        this.setAttr('shadowOffsetY', offset.y * scaleY);\n    }\n}\nexport class HitContext extends Context {\n    _fill(shape) {\n        this.save();\n        this.setAttr('fillStyle', shape.colorKey);\n        shape._fillFuncHit(this);\n        this.restore();\n    }\n    strokeShape(shape) {\n        if (shape.hasHitStroke()) {\n            this._stroke(shape);\n        }\n    }\n    _stroke(shape) {\n        if (shape.hasHitStroke()) {\n            var strokeScaleEnabled = shape.getStrokeScaleEnabled();\n            if (!strokeScaleEnabled) {\n                this.save();\n                var pixelRatio = this.getCanvas().getPixelRatio();\n                this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n            }\n            this._applyLineCap(shape);\n            var hitStrokeWidth = shape.hitStrokeWidth();\n            var strokeWidth = hitStrokeWidth === 'auto' ? shape.strokeWidth() : hitStrokeWidth;\n            this.setAttr('lineWidth', strokeWidth);\n            this.setAttr('strokeStyle', shape.colorKey);\n            shape._strokeFuncHit(this);\n            if (!strokeScaleEnabled) {\n                this.restore();\n            }\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}